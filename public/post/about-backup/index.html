<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  
<title>バックアップについて考える | tudurikata</title>


  <link rel="shortcut icon" type="image/png" href="&#x2F;images&#x2F;logo.svg">
  <meta name="viewport" content="width=device-width,initial-scale=1">

  
  <link id="style1" rel="stylesheet" type="text/css" href=https:&#x2F;&#x2F;tudurikata.com&#x2F;maindark.css>
  

</head>

<div class="header">
  <div class="site_title">
    <p><a href="/"><img src="https:&#x2F;&#x2F;tudurikata.com&#x2F;images&#x2F;logo.svg"
      alt="tudurikata" width="70" height=auto></a></p>
    <p><a href="/">&nbsp;tudurikata</a></p>
  </div>
  <div class="menu">
    <a href="/post">>archives</a>
    &nbsp;<a href="/about">>about</a>
  </div>
</div>

<body>
  <section class="section">
    <div class="container">
      
<h2>
  バックアップについて考える
</h2>

<div class="date">
  2021-03-22
</div>

<div class="taxonomies">
  
      
      <a href="https://tudurikata.com/categories/code/">/code</a>
      
  
  
      
      &emsp;<a href="https://tudurikata.com/tags/linux/">#Linux</a>
      
      &emsp;<a href="https://tudurikata.com/tags/arch-linux/">#Arch Linux</a>
      
      &emsp;<a href="https://tudurikata.com/tags/dotfiles/">#dotfiles</a>
      
      &emsp;<a href="https://tudurikata.com/tags/static-site-generator/">#Static Site Generator</a>
      
  
</div>

<p>
  <p><a href="https://tudurikata.com/post/reinstall-arch/">Arch Linuxを再インストールした話</a>に関連して。</p>
<h3 id="dotfilesnoxi-ifang">dotfilesの扱い方</h3>
<p>今回感じたのは、最低限i3と、ターミナルエミュレーター / vifm / nvimを入れて、dotfilesをリモートリポジトリから引っ張ってくれば作業環境は整うわけなので、追加のバックアップ作業はもしかしたら要らないのかも、ということ。これまではtimeshiftで定期的にバックアップをとっていたのだが、結局一度も使わないままだったし…。<br />
逆に上記のパッケージのdotfilesがリモートに存在しない場合、動くことは動くが、細かい設定を整えようとするとかなり面倒くさいことになってしまうので、思っていた以上にdotfilesのバックアップは大事だったとも言える（r/unixpornに貼りつけるだけのアレじゃなかった）。</p>
<p>シェルスクリプトでdotfilesの設定ファイルのシンボリックリンクを各所に貼るプログラムを書いている人が多いと思うが、同じようなものをNimでさくっと書いてみたので貼っておきます。</p>
<pre style="background-color:#2b303b;">
<code class="language-nim" data-lang="nim"><span style="color:#b48ead;">import</span><span style="color:#c0c5ce;"> os

</span><span style="color:#b48ead;">let</span><span style="color:#c0c5ce;"> dotfiles = </span><span style="color:#8fa1b3;">getCurrentDir</span><span style="color:#c0c5ce;">()
</span><span style="color:#b48ead;">let</span><span style="color:#c0c5ce;"> home = </span><span style="color:#8fa1b3;">getHomeDir</span><span style="color:#c0c5ce;">()

</span><span style="color:#b48ead;">for</span><span style="color:#c0c5ce;"> kind, path </span><span style="color:#b48ead;">in </span><span style="color:#8fa1b3;">walkDir</span><span style="color:#c0c5ce;">(dotfiles):
  </span><span style="color:#b48ead;">let</span><span style="color:#c0c5ce;"> (dir, name, ext) = path.splitFile
  </span><span style="color:#b48ead;">if</span><span style="color:#c0c5ce;"> name == </span><span style="color:#a3be8c;">&quot;dotfiles&quot;</span><span style="color:#c0c5ce;">: </span><span style="color:#b48ead;">continue
  else</span><span style="color:#c0c5ce;">:
    </span><span style="color:#b48ead;">if</span><span style="color:#c0c5ce;"> kind == pcFile:
      </span><span style="color:#b48ead;">let</span><span style="color:#c0c5ce;"> target1 = home &amp; name &amp; </span><span style="color:#8fa1b3;">ext
      removeFile</span><span style="color:#c0c5ce;">(target1)
      path.</span><span style="color:#8fa1b3;">createSymlink</span><span style="color:#c0c5ce;">(target1)
    </span><span style="color:#b48ead;">if</span><span style="color:#c0c5ce;"> kind == pcDir:
      </span><span style="color:#b48ead;">if</span><span style="color:#c0c5ce;"> name != </span><span style="color:#a3be8c;">&quot;.git&quot;</span><span style="color:#c0c5ce;">:
        </span><span style="color:#b48ead;">for</span><span style="color:#c0c5ce;"> fkind, fpath </span><span style="color:#b48ead;">in </span><span style="color:#8fa1b3;">walkDir</span><span style="color:#c0c5ce;">(path):
          </span><span style="color:#b48ead;">let</span><span style="color:#c0c5ce;"> (fdir, fname, fext) = fpath.splitFile
          </span><span style="color:#b48ead;">if</span><span style="color:#c0c5ce;"> fname != </span><span style="color:#a3be8c;">&quot;colors&quot;</span><span style="color:#c0c5ce;">:
            </span><span style="color:#b48ead;">let</span><span style="color:#c0c5ce;"> configName = name &amp; </span><span style="color:#a3be8c;">&quot;/&quot; </span><span style="color:#c0c5ce;">&amp; fname &amp; fext
            </span><span style="color:#b48ead;">let</span><span style="color:#c0c5ce;"> target2 = home &amp; </span><span style="color:#a3be8c;">&quot;.config/&quot; </span><span style="color:#c0c5ce;">&amp; </span><span style="color:#8fa1b3;">configName
            removeFile</span><span style="color:#c0c5ce;">(target2)
            fpath.</span><span style="color:#8fa1b3;">createSymlink</span><span style="color:#c0c5ce;">(target2)
</span></code></pre>
<p><code>os</code>ライブラリの<code>createSymlink</code>は同名のファイルが存在した場合failになるので、ファイルを削除してからシンボリックリンクを作成している。つまりファイル削除を含むプログラムなので、利用する場合は自己責任でお願いします。
nvimのcolorsディレクトリを除いているのはこれ以上コードが入れ子になるのが嫌だったから、程度の理由。</p>
<h3 id="shu-kitupanasikodonoxi-ifang">書きっぱなしコードの扱い方</h3>
<p>これまで練習用に書いてきたHaskellやらRustやらのコードはクリーンインストールによりすべて消えてしまった。まあ見返すことはほとんどなかったし、作り途中のプロジェクトはGitLabのプライベートリポジトリに上げながらやっているから無事だ。それ以外にも、ちょっと面倒な感じの、たとえばHaskellでスクレイピングするプログラムの骨子などはサイトに上げているので、残りのちまちましたやつ（Project Eulerの解答とか）は別にいいかな…と思いつつ、でもやっぱりちょっとさびしい。<br />
こういう断片的なコードをいちいちGitHub GistsやGitLab Snippetsに上げるか、それとも書き捨てのつもりで気にしないかはけっこう微妙な問題だと思う。見返さなかったとはいえ、振り返ると意外と発見があったり、最近書いていない言語を思い出すのに使ったり、ということもあるだろうし、悩ましい。<br />
<a href="https://note.com/konojunya/n/n461544d2f881">Gistsに自動アップロードするCLIを書いている</a>方を見つけて、なるほど、と思ったが、書いた端から上げたい感じもある。VS Codeのエクステンションとか、もうありそうだな…と思ったら<a href="https://github.com/kenhowardpdx/vscode-gist">あった</a>。自分なりに使いそうなフローで何かCLIを作ってみてもいいかもしれない。<br />
GitLabも<a href="https://docs.gitlab.com/ee/api/snippets.html#get-a-single-snippet">Snippets APIの紹介がとてもよくまとまっている</a>のでけっこう使いやすそう。</p>
<h3 id="jing-de-saitozieneretanoluo-tosixue">静的サイトジェネレーターの落とし穴(?)</h3>
<p>それと、Hugo / Zolaなどの静的サイトジェネレーターを使っている場合は、サイト上にフロントマター付きの.mdファイルが存在するわけではないので、もしデータが消えてしまった場合はサイト上のテキストをコピーしてきて、あらためて.mdとしてタグ付けをしないといけない（もしくはサイトをスクレイピングして.mdファイルを生成するプログラムを書くか。できなくはないが面倒ではある）。<br />
幸い、数か月前までプライベートリポジトリにサイトごと上げていたので、手作業での.md復旧は数記事で済んだのだが、これがまったくバックアップがない状況だったらけっこう辛かったかもしれない。プライベートリポジトリでもいいので更新時にpushしておくのが大事だとしみじみ思った（もちろん、github.ioなどでサイトをホスティングしている場合は当然バックアップがとれているのでこんなことは考えなくていい）。</p>
<h3 id="owarini">おわりに</h3>
<p>以上に書いたものはすべてgitのリモートリポジトリの存在が前提になっている。ここに何か落とし穴がまだあるかもしれない。</p>

</p>




    </div>
  </section>
</body>

<div class="footer">
  <a href="/">tudurikata</a>&emsp;&copy; Kyohei Uto<br>
  powered by <a href="https://www.getzola.org/">Zola</a>, theme <a href="https://gitlab.com/kyoheiu/emily_zola_theme">emily</a>.
</div>

</html>
