<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  
<title>Haskell環境再構築 | tudurikata</title>


  <link rel="shortcut icon" type="image/png" href="&#x2F;images&#x2F;penguin.png">
  <meta name="viewport" content="width=device-width,initial-scale=1">

  
  <link id="stylesheet" rel="stylesheet" type="text/css" href="/dark.css">
  

<script type="text/javascript" src="/js/theme.js"></script>

</head>

<div class="header">
  <div class="site_title">
    <p><a href="/"><img src="https:&#x2F;&#x2F;tudurikata.com&#x2F;images&#x2F;penguin.png"
      alt="tudurikata" width="70" height=auto></a></p>
    <p><a href="/">&nbsp;tudurikata</a></p>
  </div>
  <div class="menu">
    <a href="/post">>archives</a>
    &nbsp;<a href="/about">>about</a>

    

  </div>
</div>

<body onload = "getTheme()">
  <section class="section">
    <div class="container">
      
<p>
  <div class="title_postpage">Haskell環境再構築</div>
</p>
<p>
  <div class="date_postpage">2021-05-05</div>
  <div class="taxonomies_postpage">
  
      
      <a href="https://tudurikata.com/categories/code/">/code</a>
      
  
  
      
      &emsp;<a href="https://tudurikata.com/tags/haskell/">#Haskell</a>
      
      &emsp;<a href="https://tudurikata.com/tags/haskell-language-server/">#haskell-language-server</a>
      
  
  </div>
</p>

<p>
  <p>ここ数ヶ月、ずっとimperative programmingをしていてちょっと疲れてきたのと、今Haskellに戻ったら前よりはもう少し書ける／わかるようになっているかもしれないという期待で、あらためてHaskellに入門してみる。</p>
<h3 id="huan-jing-gou-zhu">環境構築</h3>
<p>前にやっていたときは確か存在していなかったような気がするのだが、<code>ghcup</code>という<code>rustup</code>的なツールが登場していたのでさっそく入れてみる。<br />
これはghc, cabal, haskell-language-server(HLS)のインストール・バージョン管理を行ってくれるありがたいツールで、途中２回ほどコマンド入力する場面があるので完全放置では完了まで行かないが、スムーズにインストールが可能。以前はstackを使っていたが、cabalがだいぶフレンドリーになってきているという噂を見かけたのでcabal一本でやってみようかと思っている。</p>
<h3 id="gui-men-haskell-language-server">鬼門・haskell-language-server</h3>
<p><code>hie</code>の頃からHaskellのLSPにはいい思い出がなく、ビルド時間が地獄のように長いとか、頑張って入れても全然動かないとかで、この辺の環境構築周りのもどかしさもあっていったん離れることに決めたのだった。今はというと、ほぼ公式のLSPであるHLSがghcupでツルッと入ってくる。これを使えばいい。</p>
<p>ただ、Arch Linux系のディストロを使っている人は、HLSとVS Codeのインテグレーションでおそらく引っかかるだろう。</p>
<p><a href="https://github.com/haskell/haskell-language-server/issues/236">VSCode extension not detecting Cabal/Stack due to incomplete $PATH in <code>/etc/profile</code> · Issue #236 · haskell/haskell-language-server</a></p>
<p>このissueで指摘されているが、Arch系の場合、<code>.bashrc</code>にghcupのPATHを書いてもVS Codeが認識せず、<code>etc/profile</code>に書かないと動かない。<del>そして僕の場合は、<code>etc/profile</code>に書いた上で、（ランチャーからではなく）ターミナルから<code>code</code>とコマンドを打って起動しないとHLSが動かなかった。ここまでわかるのに半日費やしてしまった…。</del></p>
<p>(2021-05-22追記)<code>etc/profile</code>への記述が間違っていた模様。以下のようにすればVS Codeでバッチリ動いてくれました。</p>
<pre><code># etc&#x2F;profile
PATH=~&#x2F;.ghcup&#x2F;bin&#x2F;:$PATH
PATH=~&#x2F;.cabal&#x2F;bin&#x2F;:$PATH
</code></pre>
<p>ランチャーからの起動が実質できないのは良くないので、これを機にneovimでの編集に移行してみる。<br />
ただしvim/neovimであっても、Arch系であれば<code>etc/profile</code>にPATHを書かなければならないのは同じ（記入後、要再起動）。その上で、HLS公式のイントロダクションに書いてあるとおり、CocでHLSを設定すれば、動く。</p>
<p>久々にHaskellを書くと、頭も指も全然動かなくて逆に面白い。<br />
以前いじっていたときには存在に気づかなかったパイプライン演算子を使って、Project Eulerの２問め。</p>
<pre data-lang="hs" class="language-hs "><code class="language-hs" data-lang="hs">import Data.Function

fib:: Integer -&gt; Integer -&gt; Integer -&gt; Integer
fib a b count
    | count == 1 || count == 0 = b
    | count &gt;= 2 = fib b (a+b) (count-1)
    | otherwise = 0

makeFib = fib 1 1

euler2FibList:: Integer -&gt; Integer
euler2FibList n = takeWhile (\x -&gt; makeFib x &lt; n) [1..] &amp; map makeFib &amp; filter even &amp; sum

main = print $ euler2FibList 4000000
</code></pre>
<p><code>makeFib</code>を２回使っているのがかっこよくないですね。</p>

</p>




    </div>
  </section>
</body>

<div class="footer">
  <a href="/">tudurikata</a>&emsp;&copy; Kyohei Uto<br>
  powered by <a href="https://www.getzola.org/">Zola</a>, theme <a href="https://github.com/kyoheiu/emily_zola_theme">emily</a>.
</div>

</html>