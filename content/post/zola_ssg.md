+++
title = "静的サイトジェネレーターZolaへ移行する"
date = 2021-01-05
draft = true
[taxonomies]
categories = ["code"]
tags = ["Zola", "Tera Template", "HTML", "SSG"]
+++
### 概要
以前はGo製のSSG(Static Site Generator, 静的サイトジェネレーター)Hugoを使っていたのだけれど、ちょっと色々考えた結果、Rust製SSGのZolaに乗り換えることに決めた。単純な.mdファイルの移行では歯が立たないところが何箇所かあったので、記録として残しておきます。

### 移行理由
HugoではAcademicという（おそらく）メジャーなthemeを使っていて、特に支障があったわけでもなかったのだけれど、気になるといえば気になっていたのが以下の点。
- なんとなく設定ファイルがごちゃっとしていて、何が何を通って何になっているのかよくわかっていない感じ。
- 細かいところが気になったとき、すらすらと自分で書き直せるほどの理解を得ないまま使っている感じ。
直接的な動機になったのは、各記事のカテゴリやタグを記事一覧でちゃんと表示してくれる、かつデザイン的に好みのthemeが見つからなかったことだった。結果的には、Zolaに移行したことで、上記２点の気になるポイントは解消された気がする。

### pros/cons
先に、Zolaのpros/consを書いておく。他のSSGはHugoしか使ったことがない、という点は差し引いて見ていただければ。
#### pros
- buildが通ればだいたい大丈夫という安心感
コンパイルが通ればだいたい大丈夫というrust的なものを感じる。
- buildエラー時のメッセージが丁寧かつ有用
Hugoでは何も考えずthemeを使っていたのでそもそもあまりエラーが出なかった印象だが、一から独自変数ありの.htmlを組んでいく中でこれはとても有難かった。冷淡なメッセージだったら途中でやめていたと思う。
- ファイル数が少なく済む
デザインこそ違えど内容は同じサイトのpublicディレクトリについて、
Hugo: 114 directories, 126 files
Zola: 54 directories, 62 files
ほぼ半分という結果になっている。主な原因として、Hugoのほうはひとつの記事につき、.htmlと.xml両方を吐き出すが、Zolaのほうは.htmlのみになっている。ないほうがいい、という単純な話でもないかもしれないが、これは時短には大きく寄与する。というのは、アップロードに要する時間はファイル数に大きく左右されるという実感があるから。
#### cons
- 手間がかかる
何も考えず.mdを作ってthemeを適用したら出来上がり、というものではないので、基本的には公式ドキュメントにある通りいくつかの.htmlファイル、.css（もしくはscss）を用意し、config.tomlも自分で構築しないといけない。また、.htmlを作成する際、Tera Templateという独特のテンプレートエンジンを使う必要があり、学習コストが高いとまでは言わないけれど、お目当ての機能にたどり着くのにけっこう時間はかかるというのが実感。
慣れるとそこそこ扱いやすいこのTera Template、rust用のエンジンということなので、rustを普段書いている人にとっては学習しておくと一石二鳥…かどうかはよくわかりません。
- themeがまだまだ少なそう
公式で紹介されているのは2021年初頭時点で29。一方さすがのHugoは公式に載っているものだけでも300近くあるようなので、ここの差は人によっては大きいと思う。ただし、結局自分好みのサイトにしようと思うなら、自分でいじらないといけない範囲が広いので、自力で全部書くのであれば関係ない。後述するように、僕もthemeは使っていない。
- 公式ドキュメントが若干わかりにくい
トータルで見ると必要なことは全部書いてあるのだが、個別のページに載せるべきことをoverviewにさらっと書いてあったりするので混乱しがち。できれば全体に目を通してから着手すべきだが面倒ではある。
- hugo new post/new.mdのような記事作成コマンドがない
人によっては若干不親切と感じられるかもしれない。

総合して考えると個人的にはZolaのほうが馬が合う感じで好み。いちから自分の手でちまちま構築する（必要がある）雰囲気がArchと似ていて、「これについては自分が一番よく知っているし、何かあったら自分でなんとかできるはず」という感覚を得られる。これが個人的にはけっこう大事なポイントなので。

### Getting Started
// 以下は、themeを使用しない場合の導入方法です。

基本的な構造は、公式のドキュメントのGetting Started内Overview~Configurationを通読すれば把握できるはず。

```
$ tree
.
├── config.toml
├── content
├── sass
├── static
├── templates
└── themes

```

まずzola init site-nameしたときに生成されるのは上記のディレクトリおよびファイル。
さらにtemplateの中身は以下。

```
[templates]$ tree
.
├── base.html
├── categories
│   ├── list.html
│   └── single.html
├── index.html
├── post.html
├── post-page.html
└── tags
    ├── list.html
    └── single.html
```

templatesに入っているこれらすべてのファイルと、親ディレクトリのconfig.tomlが必須。（タグ等の分類を使わなければtagsとcategoriesディレクトリは不要）。
このうち、config.tomlとbase.html、index.html、post.html、post-page.htmlはおおむね公式に雛形が掲載されているのでどうにかなるが、分類に使うlist.html single.htmlはまともなイントロダクションがないので自分で考えなければならない。そしてもちろん、雛形が存在するといっても、themeを使わないのであれば、いろいろといじくっていく必要がある（し、おそらくthemeを使ったとしても、詳細にカスタマイズするには全体の構造を理解していないと難しいように思われる）。

### 全体構造
詳細はドキュメントを参照。ざっくり言うと、
- base.html すべてのページの雛形。head、headerなどはここに書く。
- index.html いわゆるトップページの内容。
- post.html, post-page.html それぞれ、記事一覧と各記事ページの内容。
これらの.htmlに、content内各ディレクトリの_index.mdと各記事.md内の変数が挿入され、さらにsass/main.cssが適用されて記事ページが出力される、という構造になっている。この.md -> .htmlという流れを可能にしているのがTera Template流の変数の仕組みであり、Zolaの肝でもある。

### tips
以上が分かればあとは自分好みに仕上げていくだけだが、個人的に詰まったところ・記録しておきたいところを書いておく。

#### Hugo(Academic)からの移行
Academicの.mdテンプレートはフロントマター（タイトルや投稿日などの記事のメタデータ）の区切りが+++でなく---になっているので、逐一変換する必要がある。記事数が多い場合は何らかのスクリプトを組まないと厳しそう。

#### シンタックスハイライト
config.tomlに好みのテーマを書き、各.mdのコードブロック先頭に言語を明示することできれいに適用される。対応しているテーマが少ないので、こだわりのある人は先に公式をチェックしておこう。

#### 内部リンク
独特の内部リンク文法を使用しており、たとえば記事内で/post/hoge.mdにリンクを貼りたいときは@/post/hoge.mdとなる。

#### taxonomies
Zolaにおけるタグやカテゴリなどのtaxonomiesは各記事のフロントマターに明示するだけではダメで、templatesに[taxonomies]/list.html [taxonomies]/single.html という２種類のテンプレートを作る必要がある。今のところ公式のドキュメントはこれについては貧しいので、自分のを以下に貼っておきます。参考までに。

#### scss
cssのメタ言語だが、学習コストはかなり低いので触っておいて損はないと思う。といっても自分はscss独自の機能はほぼ使用していないけれど…。

#### index.htmlに直接記事一覧を表示する
set_section関数を使用してpage.htmlを拾った上で、for構文を用いて表示する。
全記事でなく一部のみを表示したい場合はループカウントすることになるが、Tera Templateはloop.indexという特殊変数を用いてカウントするので注意。

#### 画像
base.htmlのheader内で使用する画像はstatic/images/におくこと。

#### config.extra.variable
config.tomlの[extra]（自作の設定）でなるべく変数定義することでコードがクリーンになる気がする。ただし、.scss内で自作変数を使うことはできなかった。.scssでなく直接.cssを書いて置いておくのであれば使える可能性はありそう。

#### 数式
数式の表示はmathjaxを使用した。これも関連する部分のコードを貼っておくので参考までに。

### まとめると
わかってくると楽しい、そういうジェネレーターです。興味がある方はぜひ。